<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3DGS å¼ºåŠ›è°ƒè¯•ç‰ˆ</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #222; font-family: monospace; }
        
        /* å±å¹•æ—¥å¿—çª—å£ï¼šä¸“é—¨ç”¨æ¥æ˜¾ç¤ºæŠ¥é”™ */
        #console-log {
            position: absolute; top: 0; left: 0; width: 100%; height: 50%;
            background: rgba(0,0,0,0.8); color: #0f0; pointer-events: none;
            overflow-y: auto; padding: 10px; font-size: 12px; z-index: 9999;
            white-space: pre-wrap; word-wrap: break-word;
        }

        #startBtn {
            position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);
            padding: 15px 30px; font-size: 18px; z-index: 100;
        }
    </style>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/",
            "@mkkellogg/gaussian-splats-3d": "https://unpkg.com/@mkkellogg/gaussian-splats-3d@0.3.9/build/gaussian-splats-3d.module.js"
        }
    }
    </script>
</head>
<body>

    <!-- è¿™é‡Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„ä¸‹è½½è¿›åº¦å’ŒæŠ¥é”™ -->
    <div id="console-log">å‡†å¤‡å°±ç»ª...ç­‰å¾…æ“ä½œ...</div>
    <button id="startBtn">å¼€å§‹åŠ è½½æ¨¡å‹</button>

    <script type="module">
        import * as THREE from 'three';
        import { Viewer } from '@mkkellogg/gaussian-splats-3d';

        // ==========================================
        // ã€è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ Hugging Face é“¾æ¥ã€‘
        // å»ºè®®å»æ‰ ?download=true
        const MODEL_FILE = 'https://huggingface.co/ä½ çš„ç”¨æˆ·å/ä»“åº“å/resolve/main/scene.splat';
        // ==========================================

        const logDiv = document.getElementById('console-log');
        
        // é‡å†™ console.logï¼Œè®©å®ƒæ˜¾ç¤ºåœ¨å±å¹•ä¸Š
        function log(msg) {
            logDiv.innerHTML += msg + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(msg);
        }

        function error(msg) {
            logDiv.innerHTML += '<span style="color:red">[ERROR] ' + msg + '</span>\n';
            console.error(msg);
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            log("æ­£åœ¨åˆå§‹åŒ–å¼•æ“...");
            init();
        });

        function init() {
            try {
                const viewer = new Viewer({
                    'cameraUp': [0, 1, 0],
                    'initialCameraPosition': [0, 1, 5],
                    'initialCameraLookAt': [0, 0, 0],
                });

                // ç›‘å¬ä¸‹è½½è¿›åº¦ï¼ˆå¦‚æœæœåŠ¡å™¨æ”¯æŒï¼‰
                log("å¼€å§‹è¯·æ±‚æ–‡ä»¶: " + MODEL_FILE);
                
                viewer.addSplatScene(MODEL_FILE, {
                    'showLoadingUI': false, // æˆ‘ä»¬è‡ªå·±æ‰“å°æ—¥å¿—ï¼Œå…³æ‰é»˜è®¤UI
                    'splatAlphaRemovalThreshold': 5,
                    'scale': [1, 1, 1],
                    // è‡ªå®šä¹‰è¿›åº¦å›è°ƒå‡½æ•°
                    'onProgress': (percent, percentStr, chunk) => {
                        log(`ä¸‹è½½ä¸­... ${percentStr}%`);
                    }
                })
                .then(() => {
                    log("âœ… åŠ è½½å®Œæˆï¼Processing...");
                    viewer.start();
                    log("ğŸš€ æ¸²æŸ“å·²å¯åŠ¨ï¼");
                    // éšè—æ—¥å¿—æ¡†ä»¥ä¾¿è§‚çœ‹
                    setTimeout(() => { logDiv.style.display = 'none'; }, 3000);
                })
                .catch((err) => {
                    error("åŠ è½½å¤±è´¥ï¼åŸå› å¦‚ä¸‹ï¼š");
                    error(err.message || JSON.stringify(err));
                    
                    // å¸¸è§é”™è¯¯åˆ¤æ–­
                    if(err.message && err.message.includes('404')) {
                        error("ğŸ‘‰ åˆ†æï¼šé“¾æ¥é”™äº†ï¼Œæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚è¯·æ£€æŸ¥URLæ˜¯å¦åŒ…å« resolve/main");
                    } else if(err.message && err.message.includes('Cors') || err.message.includes('Failed to fetch')) {
                        error("ğŸ‘‰ åˆ†æï¼šè·¨åŸŸ(CORS)è¢«æ‹¦æˆªã€‚");
                    }
                });

            } catch (e) {
                error("ç³»ç»Ÿå´©æºƒï¼š" + e.message);
            }
        }
    </script>
</body>
</html>
