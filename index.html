<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3DGS æµé‡ç›‘æ§ç‰ˆ</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: #0f0; font-family: monospace; }
        #log { position: absolute; top: 0; left: 0; padding: 20px; white-space: pre-wrap; z-index: 999; }
    </style>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/",
            "@mkkellogg/gaussian-splats-3d": "https://unpkg.com/@mkkellogg/gaussian-splats-3d@0.3.9/build/gaussian-splats-3d.module.js"
        }
    }
    </script>
</head>
<body>
    <div id="log">å‡†å¤‡å¼€å§‹ä¸‹è½½...</div>
    <script type="module">
        import * as THREE from 'three';
        import { Viewer } from '@mkkellogg/gaussian-splats-3d';

        // ä½ çš„ Hugging Face ç›´é“¾ (ä¸è¦å¸¦ proxy)
        const MODEL_URL = 'https://huggingface.co/datasets/liu1230/my-3dgs/resolve/main/scene.splat?download=true'; 

        const logDiv = document.getElementById('log');
        function log(msg) { logDiv.innerText = msg; }

        async function start() {
            try {
                log("ğŸš€ ç¬¬ä¸€æ­¥ï¼šå¼€å§‹æ‰‹åŠ¨ä¸‹è½½æ–‡ä»¶ (ç»•è¿‡å¼•æ“bug)...");
                
                const response = await fetch(MODEL_URL);
                if (!response.ok) throw new Error("ä¸‹è½½å¤±è´¥: " + response.status);

                const reader = response.body.getReader();
                let receivedLength = 0; // å½“å‰æ”¶åˆ°çš„å­—èŠ‚æ•°
                let chunks = []; // å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®å—
                
                while(true) {
                    const {done, value} = await reader.read();
                    if (done) break;
                    
                    chunks.push(value);
                    receivedLength += value.length;
                    
                    // å®æ—¶æ˜¾ç¤ºä¸‹è½½é‡ (MB)
                    const mb = (receivedLength / 1024 / 1024).toFixed(2);
                    log(`ğŸ“¥ æ­£åœ¨ä¸‹è½½... å·²æ¥æ”¶: ${mb} MB`);
                }

                log(`âœ… ä¸‹è½½å®Œæˆï¼æ€»å¤§å°: ${(receivedLength / 1024 / 1024).toFixed(2)} MB\nâš™ï¸ æ­£åœ¨æ‹¼è£…æ•°æ®...`);
                
                // æŠŠæ‰€æœ‰æ•°æ®å—æ‹¼æˆä¸€ä¸ªå¤§ Blob
                const blob = new Blob(chunks);
                const objectURL = URL.createObjectURL(blob);

                log("ğŸ¬ å¯åŠ¨ 3D å¼•æ“...");
                
                const viewer = new Viewer({
                    'cameraUp': [0, 1, 0],
                    'initialCameraPosition': [0, 1, 2],
                    'initialCameraLookAt': [0, 0, 0],
                });
                
                // è¿™é‡Œæˆ‘ä»¬ä¼ çš„æ˜¯æœ¬åœ°å†…å­˜é‡Œçš„ blob é“¾æ¥ï¼Œé€Ÿåº¦æå¿«
                viewer.addSplatScene(objectURL, {
                    'showLoadingUI': false,
                    'splatAlphaRemovalThreshold': 5,
                    'scale': [1, 1, 1]
                }).then(() => {
                    log(""); // æ¸…ç©ºæ—¥å¿—
                    viewer.start();
                });

            } catch (err) {
                log("âŒ é”™è¯¯: " + err.message);
            }
        }

        start();
    </script>
</body>
</html>

